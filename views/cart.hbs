<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
   <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/all.min.css">
 

  
<style>

.title{
    margin-bottom: 5vh;
}
.card{
    margin: auto;
    max-width: 950px;
    width: 90%;
    box-shadow: 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    border-radius: 1rem;
    border: transparent;
}
@media(max-width:767px){
    .card{
        margin: 3vh auto;
    }
}
.cart{
    background-color: #fff;
    padding: 4vh 5vh;
    border-bottom-left-radius: 1rem;
    border-top-left-radius: 1rem;
}
@media(max-width:767px){
    .cart{
        padding: 4vh;
        border-bottom-left-radius: unset;
        border-top-right-radius: 1rem;
    }
}
.summary{
    background-color: #ddd;
    border-top-right-radius: 1rem;
    border-bottom-right-radius: 1rem;
    padding: 4vh;
    color: rgb(65, 65, 65);
}
@media(max-width:767px){
    .summary{
    border-top-right-radius: unset;
    border-bottom-left-radius: 1rem;
    }
}
.summary .col-2{
    padding: 0;
}
.summary .col-10
{
    padding: 0;
}.row{
    margin: 0;
}
.title b{
    font-size: 1.5rem;
}
.main{
    margin: 0;
    padding: 2vh 0;
    width: 100%;
}
.col-2, .col{
    padding: 0 1vh;
}
a{
    padding: 0 1vh;
}
.close{
    margin-left: auto;
    font-size: 0.7rem;
}
img{
    width: 3.5rem;
}
.back-to-shop{
    margin-top: 4.5rem;
}
h5{
    margin-top: 4vh;
}
hr{
    margin-top: 1.25rem;
}
form{
    padding: 2vh 0;
}
select{
    border: 1px solid rgba(0, 0, 0, 0.137);
    padding: 1.5vh 1vh;
    margin-bottom: 4vh;
    outline: none;
    width: 100%;
    background-color: rgb(247, 247, 247);
}
input{
    border: 1px solid rgba(0, 0, 0, 0.137);
    padding: 1vh;
    margin-bottom: 4vh;
    outline: none;
    width: 100%;
    background-color: rgb(247, 247, 247);
}
input:focus::-webkit-input-placeholder
{
      color:transparent;
}
.btn{
    background-color: #000;
    border-color: #000;
    color: white;
    width: 100%;
    font-size: 0.7rem;
    margin-top: 4vh;
    padding: 1vh;
    border-radius: 0;
}
.btn:focus{
    box-shadow: none;
    outline: none;
    box-shadow: none;
    color: white;
    -webkit-box-shadow: none;
    -webkit-user-select: none;
    transition: none; 
}
.btn:hover{
    color: white;
}
a{
    color: black; 
}
a:hover{
    color: black;
    text-decoration: none;
}
 #code{
    background-image: linear-gradient(to left, rgba(255, 255, 255, 0.253) , rgba(255, 255, 255, 0.185)), url("https://img.icons8.com/small/16/000000/long-arrow-right.png");
    background-repeat: no-repeat;
    background-position-x: 95%;
    background-position-y: center;
}


.dec,
.inc {
  cursor: pointer;
}

.close:hover{
   cursor: pointer;
}
       wrapper {
  width: 100%;
  max-width: 31.25rem;
  margin: 6rem auto;
}

.label {
  font-size: .625rem;
  font-weight: 400;
  text-transform: uppercase;
  letter-spacing: +1.3px;
  margin-bottom: 1rem;
}

.searchBar {
  width: 100%;
  display: flex;
  flex-direction: row;
  align-items: center;
}

#searchQueryInput {
  width: 100%;
  height: 2.8rem;
  background: #f5f5f5;
  outline: none;
  border: none;
  border-radius: 1.625rem;
  padding: 0 3.5rem 0 1.5rem;
  font-size: 1rem;
}

#searchQuerySubmit {
  width: 3.5rem;
  height: 2.8rem;
  margin-left: -3.5rem;
  background: none;
  border: none;
  outline: none;
  margin-top:-1.5rem;
}

#searchQuerySubmit:hover {
  cursor: pointer;
}
.badge{
    position:relative;
left:-0.3rem;
top:-1rem;
font-size:12px;
padding:3px;
opacity: 0.9;

}
.bg{
    
    background-color:rgb(128, 115, 115);
}


</style>
</head>
<body>

  
       
    
        
<section class="">
    <section id="nav-bar" class="" style="background-color:rgb(128, 115, 115);">
        <div class="container">
            <nav class="navbar navbar-expand-lg bg">
                <a class="navbar-brand text-white" href="/">DECORZ</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
                    aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavDropdown">
                    <ul class="navbar-nav ml-auto">




                        {{#if firstName}}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-white" href="#" id="navbarDropdownMenuLink" role="button"
                                data-toggle="dropdown" aria-expanded="false">

                                {{firstName}}

                            </a>

                            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                <a class="dropdown-item" href="/user/profile">Profile</a>
                                <a class="dropdown-item" href="/logout">Logout</a>

                            </div>

                        </li>
                        {{else}}

                        <li class="nav-item active">
                            <a class="nav-link text-white " href="/signin" style="">Login/Register</a>
                        </li>
                        {{/if}}

                        {{#if firstName}}
                        <li class="nav-item">
                            <a class="nav-link text-white " href="/user-order/{{id}}" style="">My orders</a>
                        </li>

                        {{/if}}

                        <li class="nav-item">
                            <a class="nav-link nav-cart" href="/cart/{{email}}"><i class="fa fa-lg text-warning" style="font-size:30px">&#xf07a;</i>{{#if userinfo}}<span class="badge badge-light">{{userinfo.cart.length}}</span>{{/if}}</a>
                        </li>

                    </ul>
                </div>
            </nav>
        </div>
        </section>
  

        <section id="nav-bar" class="bg-light" >
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light">

                <div class="collapse navbar-collapse" id="navbarNavDropdown">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">

                            <div class="wrapper">

                                <div class="searchBar">
                                    <input id="searchQueryInput" type="text" name="searchQueryInput"
                                        placeholder="Search" value="" />
                                    <button id="searchQuerySubmit" type="submit" name="searchQuerySubmit">
                                        <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                                            <path fill="#666666"
                                                d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/#categories">Categories</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/#products">Products</a>
                        </li>





                        
                    </ul>
                </div>
            </nav>
        </div>
        </section>
        </section>

    <div class="card mt-3">
    <div class="row">

        <div class="col-md-8  cart">
            <div class="title">
                <div class="row">
                   
                    <div class="col"><h4><b>Shopping Cart</b></h4></div>
                    <div class="col align-self-center text-right text-muted">{{userinfo.cart.length}} item</div>
               </div>
            </div>    

            <div class="row  border-bottom p-1">
              <div class="row main align-items-center ">
                  <div class="col">
                      
                  </div>
                  <div class="col">
                      <label>Product</label>
                  </div>
                  
                  <div class="col ">
                      <label>Price</label>
                    </div>
                  <div class="col">
                  <label>Quantity</label>
                </div>
                <div class="col">
                  <label>Total</label>
                </div>
                  <div class="col ">
                      
                     </div>
              </div>
          </div>
           {{#each userinfo.cart}}
            <div class="row border-top border-bottom ">
                <div class="product row main ">
                    <div class="col"><img class="img-fluid" src="/uploads/categories/{{this.pImage1}}"></div>
                    <div class="col">
                      <div class="row text-muted">{{this.pCategory}}</div>
                      <div class="row">{{this.pName}}</div>
                      
                  </div>
                  <div class="col product-price" style="margin-top: 15px">
                    <span class="product-price " id="product-price">{{this.pPrice}}</span>
                </div>
                <div class="col pq">
                  <div class="crtdiv">
                    <div class="qty">
                       <form action="/update-product" method="post" class="form">
                        
                        <span class="dec  p-1" >
                            <i class="fa fa-minus-square" aria-hidden="true"></i>
                        </span>
                        <span class="num product-quantity" id="num "  style="display:inline;width:20px;height:20px">
                            {{this.pQuantity}}
                        </span>
                        
                        <input class="numq pQuantity" name="pQuantity" id="numq" value="1" type="number" style="display: none"/>
                        <input name="pName" class="pName" value="{{this.pName}}" style="display: none;">
                      
                      
                       
                        <span class="inc p-1 ">
                            <i class="fa fa-plus-square" aria-hidden="true"></i>
                        </span>
                       </form>
                
                    </div>
                   
                </div>
                </div>
                  
                <div class="col product-total-price" style="margin-top: 15px">
                      
                  <span class="product-total-price" id="product-price-total{{this.pPrice}}">{{this.pPrice}}</span>
                 
                   
                </div>

                <div class="col">
                  <form method="post" action="/dlt-product">
                  <input name="pName" id="pName" value="{{this.pName}}" style="display: none">
                  
                  <button type="submit" class="close"><i class="fa-regular fa-trash-can" style="font-size:15px;color:red"></i></button>
                  
                  </form>
              </div>
            </div>
             
                
            </div>
            
            {{/each}}
            
            <div class="back-to-shop"><a href="/">&leftarrow;</a><span class="text-muted">Back to shop</span></div>
      
            
            </div>
        <div class="col-md-4 summary">
            <div><h5><b>Summary</b></h5></div>
            <hr>
            <div class="row">
              <div class="col" style="padding-left:0;">SUBTOTAL</div>
              <div class="col text-right" id="cart-subtotal"></div>
          </div>
          <form>
            <div class="row">
            <div class="col" style="padding-left:0;">SHIPPING</div>
            <div class="col text-right" id="cart-shipping"></div>
        </div>
            
        </form>
        <div class="row" style="border-top: 1px solid rgba(0,0,0,.1); padding: 2vh 0;">
          <div class="col">TOTAL PRICE</div>
          <div class="totals-value col text-right" id="cart-total"></div>
      </div>
      <a href="/checkout/{{userinfo.email}}"><input class="btn" type="submit" value="CHECKOUT"></a>
      
        </div>
    </div>
    
</div>

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/all.min.js"></script>
<script>
  $(document).ready(function(){
	$(window).bind('scroll', function() {
		var navHeight = $('.main-nav').height();
		if ($(window).scrollTop() > navHeight) {
			$('#nav-bar1').addClass('fixed-top');
           
            $('#nav-bar1').addClass('bg');
			//$('.nav-1').addClass('toleft');
            
		 }
		else {
			$('#nav-bar1').removeClass('fixed-top');
			//$('.nav-1').removeClass('toleft');
		 }
	});
});
  /*$(document).ready(function () {
                $('#btn').click(function () {
                    $('#btn').toggleClass("cart_clk");

                });
                $("#btn").one("click", function () {
                    $('.cart .fa').attr('data-before', '1');
                });

                var prnum = $('.num').text();
                // document.getElementById('num-q').value=document.getElementById('num').innerHTML
                $('.inc').click(function () {
                    if (prnum > 0) {
                        prnum++;
                        $('.num').text(prnum);
                        $('.cart .fa').attr('data-before', prnum);
                    }
                    document.getElementById('num-q').value=document.getElementById('num').innerHTML
                    var quantity=document.getElementById('num-q').value
                    var price=parseFloat(document.getElementById('product-price').innerHTML)
                    document.getElementById('product-price-total').innerHTML=price*quantity

                });
                $('.dec').click(function () {
                    if (prnum > 1) {
                        prnum--;
                        $('.num').text(prnum);
                        $('.cart .fa').attr('data-before', prnum);
                    }
                    document.getElementById('num-q').value=document.getElementById('num').innerHTML
                    var quantity=document.getElementById('num-q').value
                    var price=parseFloat(document.getElementById('product-price').innerHTML)
                    document.getElementById('product-price-total').innerHTML=price*quantity
                });
                 });
  });*/
$('.inc').mouseleave(function(){
  fn(this);
})
function fn(fn){
  $(fn).parent().submit();
}

$('.dec').mouseleave(function(){
 fn(this);
})

      var taxRate = 0.05;
var shippingRate = 80.00; 
var fadeTime = 300;        

    $('.inc').click(function () {
    
                increase(this);

                });        
$('.dec').click(function(){
    decrease(this);
})
  function increase(inc){
    var x=$(inc).parent();
    var y=$(x).children('.num').text();
    y=parseInt(y);
    y++;
    $(x).children('.num').text(y);
    $(x).children('.numq').val(y);
    var priceparent=$(inc).parent().parent().parent().parent().parent();
    var productprice=$(priceparent).children('.product-price').text();
    productprice=parseFloat(productprice);
    var quantity=$(x).children('.num').text();
    var linePrice=productprice*quantity;
    $(priceparent).children('.product-total-price').children('.product-total-price').each(function () {
    $(this).fadeOut(300, function() {
      $(this).text(linePrice.toFixed(2));
      //recalculateCart();
       var subtotal = 0;
  
  /* Sum up row totals */
  $('.product').each(function () {
    subtotal += parseFloat($(this).children('.product-total-price').text());
    
  });
  var tax = subtotal * taxRate;
  var shipping = (subtotal > 0 ? shippingRate : 0);
  var total = subtotal + shipping;
    $('.totals-value').fadeOut(fadeTime, function() {
    $('#cart-subtotal').html(subtotal.toFixed(2));
    $('#cart-shipping').html(shipping.toFixed(2));
    $('#cart-total').html(total.toFixed(2));
    if(total == 0){
      $('.checkout').fadeOut(fadeTime);
    }else{
      $('.checkout').fadeIn(fadeTime);
    }
    $('.totals-value').fadeIn(fadeTime);
  });
      $(this).fadeIn(300);
    });
  });  
    
    
  }  
function decrease(dec){
    var x=$(dec).parent();
    var y=$(x).children('.num').text();
    y=parseInt(y);
    if(y>1){
    y--;
    $(x).children('.num').text(y);
     $(x).children('.numq').val(y); 
     var priceparent=$(dec).parent().parent().parent().parent().parent();
    var productprice=$(priceparent).children('.product-price').text();
    productprice=parseFloat(productprice);
    var quantity=$(x).children('.num').text();
    var linePrice=productprice*quantity;
    $(priceparent).children('.product-total-price').children('.product-total-price').each(function () {
    $(this).fadeOut(300, function() {
      $(this).text(linePrice.toFixed(2));
             var subtotal = 0;
  
  /* Sum up row totals */
  $('.product').each(function () {
    
    subtotal += parseFloat($(this).children('.product-total-price').text());
    
  });
  var tax = subtotal * taxRate;
  var shipping = (subtotal > 0 ? shippingRate : 0);
  var total = subtotal + shipping;
    $('.totals-value').fadeOut(fadeTime, function() {
    $('#cart-subtotal').html(subtotal.toFixed(2));
    $('#cart-shipping').html(shipping.toFixed(2));
    $('#cart-total').html(total.toFixed(2));
    if(total == 0){
      $('.checkout').fadeOut(fadeTime);
    }else{
      $('.checkout').fadeIn(fadeTime);
    }
    $('.totals-value').fadeIn(fadeTime);
  });
      $(this).fadeIn(300);
    });
  });  
    }

}     
       var subtotal = 0;
  
  /* Sum up row totals */
  $('.product').each(function () {
    var x=$(this).children('.product-price').text();
    var y=$(this).children('.pq').children('.crtdiv').children('.qty').children('.form').children('.num').text();
    y=parseFloat(y);
    x=parseFloat(x);
    var z=x*y;
    $(this).children('.product-total-price').children('.product-total-price').text(z.toFixed(2));
    subtotal += parseFloat($(this).children('.product-total-price').text());
    
  });
  var tax = subtotal * taxRate;
  var shipping = (subtotal > 0 ? shippingRate : 0);
  var total = subtotal + shipping;
    $('.totals-value').fadeOut(fadeTime, function() {
    $('#cart-subtotal').html(subtotal.toFixed(2));
    $('#cart-shipping').html(shipping.toFixed(2));
    $('#cart-total').html(total.toFixed(2));
    if(total == 0){
      $('.checkout').fadeOut(fadeTime);
    }else{
      $('.checkout').fadeIn(fadeTime);
    }
    $('.totals-value').fadeIn(fadeTime);
  });    
function priceupdate(quantity){
    
   var x=$(quantity).parent().parent().prop('className');
   alert(x);
}



/* Assign actions */
$('.product-quantity').change( function() {
  updateQuantity(this);
});

$('.product-removal button').click( function() {
  removeItem(this);
});


/* Recalculate cart */
function recalculateCart()
{
  var subtotal = 0;
  
  /* Sum up row totals */
  $('.product').each(function () {
    subtotal += parseFloat($(this).children('.product-line-price').text());
  });
  
  /* Calculate totals */
  var tax = subtotal * taxRate;
  var shipping = (subtotal > 0 ? shippingRate : 0);
  var total = subtotal + shipping;
  
  /* Update totals display */
  $('.totals-value').fadeOut(fadeTime, function() {
    $('#cart-subtotal').html(subtotal.toFixed(2));
    $('#cart-tax').html(tax.toFixed(2));
    $('#cart-shipping').html(shipping.toFixed(2));
    $('#cart-total').html(total.toFixed(2));
    if(total == 0){
      $('.checkout').fadeOut(fadeTime);
    }else{
      $('.checkout').fadeIn(fadeTime);
    }
    $('.totals-value').fadeIn(fadeTime);
  });
}


/* Update quantity */
function updateQuantity(quantityInput)
{
  /* Calculate line price */
  var productRow = $(quantityInput).parent().parent();
  var price = parseFloat(productRow.children('.product-price').text());
  var quantity = $(quantityInput).val();
  var linePrice = price * quantity;
  
  
  /* Update line price display and recalc cart totals */
  productRow.children('.product-line-price').each(function () {
    $(this).fadeOut(fadeTime, function() {
      $(this).text(linePrice.toFixed(2));
      recalculateCart();
      $(this).fadeIn(fadeTime);
    });
  });  
}


/* Remove item from cart */
function removeItem(removeButton)
{
  /* Remove row from DOM and recalc cart total */
  var productRow = $(removeButton).parent().parent();
  productRow.slideUp(fadeTime, function() {
    productRow.remove();
    recalculateCart();
  });
}


</script>
</body>
</html>